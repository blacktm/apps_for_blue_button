/**
 * Tom Black (@blacktm) (C) 2012
 */

(function () {
var APPYARD=APPYARD||{};APPYARD.define=function(b){var b=b.split("."),c=APPYARD,a;"APPYARD"===b[0]&&(b=b.slice(1));for(a=0;a<b.length;a++)"undefined"===typeof c[b[a]]&&(c[b[a]]={}),c=c[b[a]];return c};APPYARD.define("APPYARD.Runner");APPYARD.Runner=function(){$(document).ready(function(){APPYARD.Core.runApp(CURRENT_APP)});return{}}();APPYARD.define("APPYARD.Core");APPYARD.Core=function(){var b=function(a){a=JSON.stringify(a);$.ajax({type:"POST",url:"/",data:a,dataType:"json",success:function(a){switch(a.status){case "ui":c(a.app);break;case "done":console.log("App finished.")}}})},c=function(a){console.log("Running: "+a.actions[a.next].name);APPYARD.UI.Actions.run(a)};return{runApp:function(a){var f=a.actions[a.next];void 0!==f?"ui"===f.name.slice(0,2)?c(a):b({service:"run_app",app:a}):console.log("App finished.")}}}();APPYARD.define("APPYARD.UI");APPYARD.UI=function(){return{width:function(){return $(window).width()},height:function(){return $(window).height()}}}();APPYARD.define("APPYARD.UI.View");
APPYARD.UI.View=function(){var b=function(){$("body").append('<div id="view"></div>')},c=function(){var a=-1*($("#view").height()/2),c=-1*($("#view").width()/2),a=a+$(".header").height()/2;$("#view").css("margin-top",a);$("#view").css("margin-left",c)};b();c();return{show:function(){c();$("#view").fadeIn(300)},hide:function(a){$("#view").fadeOut(300,function(){$("#view").remove();b();void 0!==a&&a()})},addDiv:function(a){a.id&&$("#view").append('<div id="'+a.id+'"></div>')},append:function(a){$("#"+
a.id).append(a.content)},width:function(a){if(a)$("#view").css("width",a);else return $("#view").width()},height:function(a){if(a)$("#view").css("height",a);else return $("#view").height()},minHeight:function(a){$("#view").css("min-height",a)},maxHeight:function(a){$("#view").css("max-height",a)},setPosition:c}}();APPYARD.define("APPYARD.UI.View.Button");APPYARD.UI.View.Button=function(){return{modal:'<div class="btn-modal" id="btn-modal">Next &rsaquo;&rsaquo;</div>'}}();APPYARD.define("APPYARD.UI.View.Content");APPYARD.UI.View.Content=function(){var b=APPYARD.UI.View;return{add:function(c){b.addDiv({id:"view-content"});$("#view-content").append(c)},maxHeight:function(c){$("#view-content").css("max-height",c)},append:function(c){$("#view-content").append(c)}}}();APPYARD.define("APPYARD.UI.View.Footer");APPYARD.UI.View.Footer=function(){var b=APPYARD.UI.View;return{add:function(c){b.addDiv({id:"view-footer"});$("#view-footer").append(c)}}}();APPYARD.define("APPYARD.UI.View.Header");APPYARD.UI.View.Header=function(){var b=APPYARD.UI.View;return{add:function(c){b.addDiv({id:"view-header"});$("#view-header").append(c)}}}();APPYARD.define("APPYARD.UI.Actions");APPYARD.UI.Actions=function(){var b=APPYARD.Core,c=[],a=null;return{run:function(b){a=b;var b=b.actions[b.next],d;d=-1!==c.indexOf(b.name)?!0:!1;d?(actionRef=eval("APPYARD.UI.Actions."+b.name),actionRef.run(b.properties)):console.log("Error: UI action does not exist.")},register:function(a){c.push(a)},getData:function(){return a.data},saveData:function(b){a.data=b},done:function(){a.next+=1;b.runApp(a)}}}();APPYARD.define("APPYARD.UI.Actions.ui_lab_view");
APPYARD.UI.Actions.ui_lab_view=function(){var b=APPYARD.UI,c=b.Actions,a=b.View,f=null,d=[{name:"Total Cholesterol",abbr:"chol",units:"mg/dL",val:null,range:{min:150,max:300},range_pts:[{title:"Desirable",pos:150},{title:"Borderline",pos:200},{title:"High",pos:240}],info:"Total blood cholesterol is a measure of LDL cholesterol, HDL cholesterol, and other lipid components. Doctors recommend total cholesterol levels below 200.",source:{title:"Bob Saget Hospital",link:"http://www.apple.com"}},{name:"Triglycerides",
abbr:"tg",units:"mg/dL",val:null,range:{min:100,max:550},range_pts:[{title:"Normal",pos:100},{title:"Borderline",pos:150},{title:"High",pos:200},{title:"Very High",pos:500}],info:"Triglycerides are the chemical form in which most fat exists in food and the body. A high triglyceride level has been linked to higher risk of coronary artery disease.",source:{title:"Bob Saget Hospital",link:"http://www.apple.com"}},{name:"Low-density lipoprotein (LDL)",abbr:"ldl",units:"mg/dL",val:null,range:{min:70,max:220},
range_pts:[{title:"Optimal",pos:70},{title:"Near Optimal",pos:100},{title:"Borderline",pos:130},{title:"High",pos:160},{title:"Very High",pos:190}],info:'LDL cholesterol can build up on the walls of your arteries and increase your chances of getting heart disease. That is why LDL cholesterol is referred to as "bad" cholesterol.',source:{title:"Bob Saget Hospital",link:"http://www.apple.com"}},{name:"High-density lipoprotein (HDL)",abbr:"hdl",units:"mg/dL",val:null,range:{min:90,max:30},range_pts:[{title:"Optimal",
pos:90},{title:"Borderline",pos:60},{title:"Low",pos:40}],info:'When it comes to HDL cholesterol -- "good" cholesterol -- the higher the number, the lower your risk.',source:{title:"Bob Saget Hospital",link:"http://www.apple.com"}}],e=40,h=function(a){f.add([{type:"text",text:a.name+" ("+a.units+")",x:25,y:e+15,"text-anchor":"start","font-family":"proxima-nova","font-size":30,"font-weight":"bold",fill:"black"}]);i(a.info);f.add([{type:"rect",x:25,y:e+45,r:3,width:750,height:50,fill:"270-#d8d8d8-#f3f3f3",
stroke:"#bfbfbf"}]);for(var b=f.rect(25,e+45,0,50).attr({r:3,fill:"270-#92d614-#43a409",stroke:"#328d07"}),c=0;c<a.range_pts.length;c++)j(a.range,a.range_pts[c]);var d=g(a.val,a.range,{min:25,max:775});f.add([{type:"text",text:a.val,x:d-10,y:e+45+25+2+1,"text-anchor":"end","font-family":"proxima-nova","font-size":24,"font-weight":"bold",fill:"#000",opacity:0.3},{type:"text",text:a.val,x:d-10,y:e+45+25+1,"text-anchor":"end","font-family":"proxima-nova","font-size":24,"font-weight":"bold",fill:"#fff"}]);
setTimeout(function(){b.animate({width:d-25},750,"backOut")},750)},g=function(a,b,c){return(a-b.min)*((c.max-c.min)/(b.max-b.min))+c.min},i=function(a){var b=f.path("M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466z M17.328,24.371h-2.707v-2.596h2.707V24.371zM17.328,19.003v0.858h-2.707v-1.057c0-3.19,3.63-3.696,3.63-5.963c0-1.034-0.924-1.826-2.134-1.826c-1.254,0-2.354,0.924-2.354,0.924l-1.541-1.915c0,0,1.519-1.584,4.137-1.584c2.487,0,4.796,1.54,4.796,4.136C21.156,16.208,17.328,16.627,17.328,19.003z");
b.attr({fill:"270-#dadada-#808080",stroke:"none"});var c=b.getBBox(!0),d=f.rect(c.x-1,c.y-1,c.width+2,c.height+2);d.attr({cursor:"pointer",fill:"white","fill-opacity":0,stroke:"none"});b.translate(743,e);d.translate(743,e);d.hover(function(){d.animate({"fill-opacity":0.2},300,"<>")},function(){d.animate({"fill-opacity":0},500,"<>")});d.click(function(){alert(a)})},j=function(a,b){var c=g(b.pos,a,{min:25,max:775}),d="0.15",h="0.3";10>c-25&&(h=d=0);f.add([{type:"rect",x:c-2,y:e+45+0.5,width:2,height:49,
fill:"#000",stroke:"none",opacity:d},{type:"rect",x:c,y:e+45+0.5,width:2,height:49,fill:"#fff",stroke:"none",opacity:h},{type:"text",text:b.title,x:c,y:e+45+50+15,"text-anchor":"start","font-family":"proxima-nova","font-size":16,"font-weight":"bold",fill:"#808080"},{type:"text",text:b.pos,x:c,y:e+45+50+35,"text-anchor":"start","font-family":"proxima-nova","font-size":16,fill:"#808080"}])};c.register("ui_lab_view");return{run:function(g){a.width("auto");a.maxHeight(b.height()-150);a.minHeight("300px");
a.Header.add(g.title);a.Content.add('<div id="canvas"></div>');g=c.getData();d[0].val=g.chol;d[1].val=g.tg;d[2].val=g.ldl;d[3].val=g.hdl;a.show();f=Raphael("canvas",800,(e+180)*d.length);for(g=0;g<d.length;g++)h(d[g]),e+=205;a.Content.maxHeight(b.height()-150-100);a.setPosition();c.done()}}}();APPYARD.define("APPYARD.UI.Actions.ui_medications_view");
APPYARD.UI.Actions.ui_medications_view=function(){var b=APPYARD.UI,c=b.Actions,a=b.View;String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})};c.register("ui_medications_view");return{run:function(f){var d=c.getData();console.log(d);a.width("auto");a.maxHeight(b.height()-150);a.minHeight("300px");a.Header.add(f.title);a.Content.add();a.Content.maxHeight(b.height()-150-100);for(f=0;f<d.length;f++){var e=d[f],h=
e.Medication.toLowerCase().replace(/[ ,\/]/g,"_"),g=e.Medication.replace(/[,\/]/g," ").toTitleCase(),e='<div class="med"><img class="med-img" src="/apps/medications/img/'+h+'.jpg"><div class="med-content"><h1 class="med-name">'+g+'</h1><p class="med-last-filled">Last Filled: '+e["Last Filled On"]+'</p><p class="med-refills">Refills remaining: '+e["Refills Remaining"]+'</p><p class="med-price"><a href="http://www.goodrx.com/price/'+h.split("_")[0]+'" target="_blank">Check price &rsaquo;&rsaquo;</a></p></div></div>';
console.log(e);a.Content.append(e)}$("#view-content").css("overflow-y","inherit");$(".med").css("width","auto");$(".med").css("margin-bottom","25px");$(".med").css("overflow","inherit");$(".med h1").css("font-size","22px");$(".med p").css("font-size","18px");$(".med-img").css("float","left");$(".med-content").css("padding-top","25px");$(".med-content").css("margin-left","275px");a.show();a.setPosition();c.done()}}}();APPYARD.define("APPYARD.UI.Actions.ui_modal");APPYARD.UI.Actions.ui_modal=function(){var b=APPYARD.UI,c=b.Actions,a=b.View,f=function(){$("#btn-modal").off();a.hide(d)},d=function(){c.done()};c.register("ui_modal");return{run:function(b){a.Header.add(b.title);a.Content.add(b.content);a.Footer.add(a.Button.modal);b.height?a.Content.maxHeight(b.height):a.Content.maxHeight("500px");b.width?a.width(b.width):a.width("500px");$("#btn-modal").on("click",f);a.show()}}}();APPYARD.define("APPYARD.UI.Actions.ui_prompt_blue_button");
APPYARD.UI.Actions.ui_prompt_blue_button=function(){var b=APPYARD.UI,c=b.Actions,a=b.View,f="",d=function(){$("#blue-button-text-field").empty();$("#blue-button-text-field").val(decodeURI(f))},e=function(){var b=$("#blue-button-text-field").val(),b=encodeURI(b);c.saveData(b);a.hide(h)},h=function(){c.done()};c.register("ui_prompt_blue_button");return{run:function(b){$.get("/blue_button_sample.txt",function(a){f=encodeURI(a)});a.Header.add(b.title);a.Content.add("<div class='center big-text'><a id='fill-blue-button' href='javascript:;'>Use sample data.</a></div><br><textarea id='blue-button-text-field' rows='20' cols='80' style='font-size:16px;font-family:monospace;'></textarea>");
a.Content.maxHeight("700px");a.Footer.add(a.Button.modal);a.width("auto");$("#btn-modal").on("click",e);a.show();$("#blue-button-text-field").focus();$("#fill-blue-button").on("click",d)}}}();APPYARD.define("APPYARD.UI.Actions.ui_view_text");APPYARD.UI.Actions.ui_view_text=function(){var b=APPYARD.UI,c=b.Actions,a=b.View;c.register("ui_view_text");return{run:function(b){var d=c.getData();switch(b.format){case "json":d=JSON.stringify($.parseJSON(d),void 0,2);break;case "xml":d=d.replace(/</g,"&#60;")}console.log(d);a.Header.add(b.title);a.Content.add("<pre>"+d+"</pre>");a.Content.maxHeight("450px");a.width("800px");$("pre").css("overflow","inherit");a.show();c.saveData("");c.done()}}}();APPYARD.define("APPYARD.UI.Actions.ui_vitals_view");APPYARD.UI.Actions.ui_vitals_view=function(){var b=APPYARD.UI.Actions;b.register("ui_vitals_view");return{run:function(){b.done()}}}();
})(CURRENT_APP);
